---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: minio
spec:
  selector:
    matchLabels:
      app: minio
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: minio
    spec:
      containers:
        - name: minio
          image: docker.io/minio/minio:RELEASE.2021-09-18T18-09-59Z
          args:
            - server
            - /data
            - --console-address
            - :9001
          env:
            - name: MINIO_PROMETHEUS_AUTH_TYPE
              value: public
            - name: MINIO_UPDATE
              value: "off"
          envFrom:
            - secretRef:
                name: application-secrets
          ports:
            - containerPort: 9000
              hostPort: 9000
              protocol: TCP
            - containerPort: 9001
              hostPort: 9001
              protocol: TCP
          securityContext:
            allowPrivilegeEscalation: true
            capabilities:
              drop:
                - CAP_MKNOD
                - CAP_NET_RAW
                - CAP_AUDIT_WRITE
            readOnlyRootFilesystem: false
            runAsGroup: 100
            runAsUser: 568
          volumeMounts:
            - name: config
              mountPath: /data
      volumes:
        - name: config
          hostPath:
            path: /tycho/System/minio
            type: Directory
